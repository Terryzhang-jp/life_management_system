# ğŸš¨ å®‰å…¨äº‹ä»¶æŠ¥å‘Šï¼šGoogle API Key æ³„éœ²

**åˆ›å»ºæ—¶é—´**: 2025-10-22
**ä¸¥é‡ç¨‹åº¦**: ğŸ”´ é«˜å±
**çŠ¶æ€**: å·²è¯†åˆ«ï¼Œå¾…ä¿®å¤

---

## ğŸ“Š é—®é¢˜æ¦‚è¿°

**æ³„éœ²çš„API Key**: `AIzaSyDmDHk_Ep3NAFn8QrvIIvuNHT2xP-8YAkU`

### æ³„éœ²ä½ç½®
- **æ–‡ä»¶**: `test-gemini.mjs` (ç¬¬4è¡Œ)
- **æäº¤**: `5aa76b3` - "feat: é‡å¤§åŠŸèƒ½æ›´æ–° - Questç³»ç»Ÿã€ç”Ÿæ´»è®°å½•ã€è¯­éŸ³è¯†åˆ«ç­‰"
- **æ—¶é—´**: æœ€è¿‘çš„æ¨é€
- **ä»“åº“**: GitHub - Terryzhang-jp/life_management_system

---

## ğŸ” è¯¦ç»†åˆ†æ

### 1. æ³„éœ²çš„ä»£ç 
```javascript
// test-gemini.mjs (ç¬¬4è¡Œ)
const apiKey = 'AIzaSyDmDHk_Ep3NAFn8QrvIIvuNHT2xP-8YAkU';  // âŒ ç¡¬ç¼–ç 
```

### 2. Gitå†å²ç¡®è®¤
```bash
$ git show 5aa76b3:test-gemini.mjs
# ç¡®è®¤ï¼šAPI Key å·²ç»è¢«æ¨é€åˆ° GitHub
```

### 3. å½±å“èŒƒå›´
- âœ… **.env.local é…ç½®æ­£ç¡®** - å·²åœ¨ .gitignore ä¸­æ’é™¤
- âœ… **å…¶ä»–æµ‹è¯•æ–‡ä»¶å®‰å…¨** - test-google-search.js ä½¿ç”¨ç¯å¢ƒå˜é‡
- âŒ **test-gemini.mjs ç¡¬ç¼–ç ** - å·²è¢«æ¨é€åˆ°å…¬å¼€ä»“åº“

---

## âš ï¸ å®‰å…¨é£é™©

### é«˜é£é™©
1. **API Key å·²å…¬å¼€** - ä»»ä½•äººéƒ½å¯ä»¥åœ¨ GitHub ä¸Šçœ‹åˆ°
2. **å¯èƒ½è¢«æ»¥ç”¨** - ä»–äººå¯ä»¥ä½¿ç”¨æ­¤ Key è°ƒç”¨ Google Gemini API
3. **è´¹ç”¨é£é™©** - å¯èƒ½äº§ç”Ÿæ„å¤–çš„ API ä½¿ç”¨è´¹ç”¨
4. **é…é¢æ¶ˆè€—** - å¯èƒ½è€—å°½ä½ çš„ API é…é¢

### æ½œåœ¨åæœ
- ğŸ’° **è´¢åŠ¡æŸå¤±** - æ¶æ„ä½¿ç”¨å¯èƒ½äº§ç”Ÿå¤§é‡è´¹ç”¨
- ğŸ“Š **é…é¢è€—å°½** - å½±å“ä½ çš„æ­£å¸¸å¼€å‘å’Œä½¿ç”¨
- ğŸ”’ **è´¦æˆ·å®‰å…¨** - Google å¯èƒ½æ£€æµ‹åˆ°å¼‚å¸¸ä½¿ç”¨å¹¶å°é”è´¦æˆ·

---

## ğŸ› ï¸ ç´§æ€¥ä¿®å¤æ–¹æ¡ˆ

### ç¬¬ä¸€æ­¥ï¼šç«‹å³æ’¤é”€æ³„éœ²çš„API Key â° ç«‹å³æ‰§è¡Œ

1. **è®¿é—® Google AI Studio**
   - å‰å¾€ï¼šhttps://aistudio.google.com/app/apikey
   - ç™»å½•ä½ çš„ Google è´¦æˆ·

2. **æ’¤é”€æ—§Key**
   - æ‰¾åˆ° Keyï¼š`AIzaSyDmDHk_Ep3NAFn8QrvIIvuNHT2xP-8YAkU`
   - ç‚¹å‡»"Delete"æˆ–"Revoke"æŒ‰é’®
   - ç¡®è®¤åˆ é™¤

3. **ç”Ÿæˆæ–°Key**
   - ç‚¹å‡»"Create API Key"
   - ä¿å­˜æ–°çš„ Keyï¼ˆä¸è¦åˆ†äº«ï¼ï¼‰

### ç¬¬äºŒæ­¥ï¼šä¿®å¤ä»£ç  ğŸ”§

#### 2.1 åˆ é™¤ç¡¬ç¼–ç çš„API Key
```bash
# åˆ é™¤ test-gemini.mjs æ–‡ä»¶ï¼ˆå»ºè®®ï¼‰
rm test-gemini.mjs

# æˆ–è€…ä¿®æ”¹ä¸ºä½¿ç”¨ç¯å¢ƒå˜é‡
```

#### 2.2 ä¿®æ”¹æ–‡ä»¶å†…å®¹ï¼ˆå¦‚æœä¿ç•™ï¼‰
```javascript
// test-gemini.mjs - ä¿®å¤å
import { google } from '@ai-sdk/google';
import { streamText } from 'ai';

// âœ… ä»ç¯å¢ƒå˜é‡è¯»å–
const apiKey = process.env.GOOGLE_GENERATIVE_AI_API_KEY;

if (!apiKey) {
  console.error('âŒ ç¼ºå°‘ GOOGLE_GENERATIVE_AI_API_KEY ç¯å¢ƒå˜é‡');
  console.error('è¯·åœ¨ .env.local æ–‡ä»¶ä¸­è®¾ç½®');
  process.exit(1);
}

// ... å…¶ä½™ä»£ç 
```

#### 2.3 æ›´æ–° .env.local
```bash
# .env.local
GOOGLE_GENERATIVE_AI_API_KEY=your_new_api_key_here
```

### ç¬¬ä¸‰æ­¥ï¼šæ¸…ç†Gitå†å² ğŸ§¹

âš ï¸ **è­¦å‘Š**: è¿™ä¼šé‡å†™ Git å†å²ï¼Œéœ€è¦å¼ºåˆ¶æ¨é€ï¼

#### é€‰é¡¹A: ä½¿ç”¨ git-filter-repoï¼ˆæ¨èï¼‰
```bash
# å®‰è£… git-filter-repo
pip install git-filter-repo

# åˆ é™¤åŒ…å«æ•æ„Ÿä¿¡æ¯çš„æ–‡ä»¶
git filter-repo --invert-paths --path test-gemini.mjs

# å¼ºåˆ¶æ¨é€
git push origin --force --all
```

#### é€‰é¡¹B: ä½¿ç”¨ BFG Repo-Cleanerï¼ˆæ›´å¿«ï¼‰
```bash
# ä¸‹è½½ BFG
# https://rtyley.github.io/bfg-repo-cleaner/

# åˆ é™¤æ•æ„Ÿæ–‡ä»¶
java -jar bfg.jar --delete-files test-gemini.mjs

# æ¸…ç†å’Œå‹ç¼©
git reflog expire --expire=now --all
git gc --prune=now --aggressive

# å¼ºåˆ¶æ¨é€
git push origin --force --all
```

#### é€‰é¡¹C: ç®€å•æ–¹æ¡ˆï¼ˆå¦‚æœæäº¤å¾ˆæ–°ï¼‰
```bash
# 1. åˆ é™¤æ–‡ä»¶
rm test-gemini.mjs
git add test-gemini.mjs
git commit -m "security: åˆ é™¤åŒ…å«æ³„éœ²API Keyçš„æµ‹è¯•æ–‡ä»¶"

# 2. é‡ç½®åˆ°æ³„éœ²ä¹‹å‰çš„æäº¤ï¼ˆå¦‚æœå¯èƒ½ï¼‰
git reset --hard <commit_before_leak>
git push origin --force

# 3. é‡æ–°åº”ç”¨å…¶ä»–æ”¹åŠ¨ï¼ˆæ‰‹åŠ¨ï¼‰
```

### ç¬¬å››æ­¥ï¼šæ›´æ–° .gitignore ğŸ“

ç¡®ä¿æ‰€æœ‰æµ‹è¯•æ–‡ä»¶éƒ½è¢«å¿½ç•¥ï¼š

```bash
# .gitignore
# æ·»åŠ ä»¥ä¸‹è§„åˆ™
test-*.mjs
test-*.js
*.test.js
*.test.mjs
```

### ç¬¬äº”æ­¥ï¼šé€šçŸ¥ GitHub ğŸ””

è™½ç„¶ä½ åˆ é™¤äº†æ–‡ä»¶ï¼Œä½† GitHub å¯èƒ½å·²ç»ç¼“å­˜ï¼š

1. **è”ç³» GitHub Support**
   - è®¿é—®ï¼šhttps://support.github.com/
   - æŠ¥å‘Šæ³„éœ²çš„ API Key
   - è¯·æ±‚æ¸…é™¤ç¼“å­˜

2. **ä½¿ç”¨ GitHub çš„å¯†é’¥æ‰«ææŠ¥å‘Š**
   - è®¿é—®ï¼šhttps://github.com/settings/security_analysis
   - æŸ¥çœ‹æ˜¯å¦æœ‰è­¦å‘Š

---

## âœ… éªŒè¯æ¸…å•

æ‰§è¡Œå®Œä¿®å¤åï¼Œç¡®è®¤ä»¥ä¸‹é¡¹ï¼š

- [ ] æ—§ API Key å·²åœ¨ Google AI Studio ä¸­æ’¤é”€
- [ ] ç”Ÿæˆäº†æ–°çš„ API Key
- [ ] æ–° Key å·²æ·»åŠ åˆ° .env.local
- [ ] test-gemini.mjs å·²åˆ é™¤æˆ–ä¿®å¤
- [ ] Git å†å²å·²æ¸…ç†ï¼ˆæ²¡æœ‰ç¡¬ç¼–ç çš„ Keyï¼‰
- [ ] .gitignore å·²æ›´æ–°
- [ ] ä»£ç æ¨é€åˆ° GitHubï¼ˆå¼ºåˆ¶æ¨é€ï¼‰
- [ ] æµ‹è¯•åº”ç”¨åŠŸèƒ½æ­£å¸¸
- [ ] ç›‘æ§ API ä½¿ç”¨æƒ…å†µï¼ˆå‡ å¤©å†…ï¼‰

---

## ğŸ“š é¢„é˜²æªæ–½

### 1. ä»£ç å®¡æŸ¥è§„åˆ™
- âŒ æ°¸è¿œä¸è¦ç¡¬ç¼–ç  API Keys
- âœ… å§‹ç»ˆä½¿ç”¨ç¯å¢ƒå˜é‡
- âœ… ä½¿ç”¨ .env.local (å·²åœ¨ .gitignore ä¸­)

### 2. Git Hooksï¼ˆå»ºè®®ï¼‰
å®‰è£… pre-commit hook æ£€æŸ¥æ•æ„Ÿä¿¡æ¯ï¼š

```bash
# å®‰è£… pre-commit
pip install pre-commit

# åˆ›å»º .pre-commit-config.yaml
cat > .pre-commit-config.yaml <<EOF
repos:
  - repo: https://github.com/Yelp/detect-secrets
    rev: v1.4.0
    hooks:
      - id: detect-secrets
        args: ['--baseline', '.secrets.baseline']
EOF

# å®‰è£… hooks
pre-commit install
```

### 3. GitHub å¯†é’¥æ‰«æ
å¯ç”¨ GitHub çš„å¯†é’¥æ‰«æåŠŸèƒ½ï¼š
- å‰å¾€ï¼šSettings â†’ Security â†’ Code security and analysis
- å¯ç”¨ï¼šSecret scanning

### 4. ç¯å¢ƒå˜é‡æœ€ä½³å®è·µ
```javascript
// âœ… æ­£ç¡®æ–¹å¼
const apiKey = process.env.GOOGLE_GENERATIVE_AI_API_KEY;

if (!apiKey) {
  throw new Error('Missing GOOGLE_GENERATIVE_AI_API_KEY');
}

// âŒ é”™è¯¯æ–¹å¼
const apiKey = 'AIzaSy...';  // æ°¸è¿œä¸è¦è¿™æ ·åšï¼
```

---

## ğŸ“ ç´§æ€¥è”ç³»

å¦‚æœå‘ç° API è¢«æ»¥ç”¨ï¼š

1. **Google Cloud Console**
   - https://console.cloud.google.com/
   - æŸ¥çœ‹ API ä½¿ç”¨æƒ…å†µ
   - è®¾ç½®é¢„ç®—è­¦æŠ¥

2. **Google Support**
   - https://support.google.com/

---

## ğŸ“Š æ‰§è¡Œå‘½ä»¤æ±‡æ€»

```bash
# 1. åˆ é™¤æ³„éœ²çš„æ–‡ä»¶
rm test-gemini.mjs

# 2. æ›´æ–° .gitignore
echo "test-*.mjs" >> .gitignore
echo "test-*.js" >> .gitignore

# 3. æäº¤ä¿®å¤
git add .gitignore test-gemini.mjs
git commit -m "security: åˆ é™¤æ³„éœ²API Keyçš„æµ‹è¯•æ–‡ä»¶å¹¶æ›´æ–°.gitignore"

# 4. æ¸…ç†Gitå†å²ï¼ˆé€‰æ‹©ä¸€ç§æ–¹æ³•ï¼‰
# æ–¹æ³•A: git-filter-repo
git filter-repo --invert-paths --path test-gemini.mjs

# æ–¹æ³•B: BFG
java -jar bfg.jar --delete-files test-gemini.mjs
git reflog expire --expire=now --all
git gc --prune=now --aggressive

# 5. å¼ºåˆ¶æ¨é€
git push origin --force --all
git push origin --force --tags
```

---

## ğŸ“ ç»éªŒæ•™è®­

1. **æµ‹è¯•æ–‡ä»¶ä¹Ÿè¦å®¡æŸ¥** - ä¸è¦è®¤ä¸ºæµ‹è¯•æ–‡ä»¶ä¸é‡è¦
2. **ä½¿ç”¨ç¯å¢ƒå˜é‡** - å³ä½¿æ˜¯ä¸´æ—¶æµ‹è¯•ï¼Œä¹Ÿè¦ä½¿ç”¨ .env.local
3. **æäº¤å‰æ£€æŸ¥** - å…»æˆ `git diff` çš„ä¹ æƒ¯
4. **è‡ªåŠ¨åŒ–æ£€æŸ¥** - ä½¿ç”¨ pre-commit hooks
5. **å®šæœŸå®¡è®¡** - å®šæœŸæ£€æŸ¥ä»£ç ä¸­çš„æ•æ„Ÿä¿¡æ¯

---

**æœ€åæ›´æ–°**: 2025-10-22
**å¤„ç†çŠ¶æ€**: âš ï¸ å¾…ç”¨æˆ·æ‰§è¡Œä¿®å¤æ­¥éª¤
